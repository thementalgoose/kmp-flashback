name: Job - Android - Deploy AAB to Google Play

on:
  workflow_call:

jobs:
  deploy:
    name: Deploy to play store
    runs-on: ubuntu-latest
    steps:

      # Download AAB + Mapping
      - name: Download AAB
        uses: actions/download-artifact@v4
        with:
          name: AAB

      - name: Logging
        run: | 
          ls -R composeApp/build/outputs

      # Deploy
      - name: Deploy Bundle to google Play
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJsonPlainText: ${{ secrets.ANDROID_SERVICE_ACCOUNT }}
          packageName: tmg.flashback
          releaseFiles: composeApp/build/outputs/bundle/**/*.aab
          track: internal
          status: "completed"
          mappingFile: composeApp/build/outputs/mapping/**/mapping.txt